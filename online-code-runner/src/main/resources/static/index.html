<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Online Code Runner</title>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f0f0; }
    h1 { color: #333; }
    textarea, input, select, button { width: 100%; padding: 8px; margin: 5px 0; font-family: monospace; }
    textarea { height: 150px; }
    .testcase { border: 1px solid #ccc; padding: 10px; margin: 5px 0; background-color: #fff; }
    .results { white-space: pre-wrap; background: #222; color: #0f0; padding: 10px; margin-top: 10px; }
    .btn-small { width: auto; margin-top: 5px; }
</style>
</head>
<body>

<h1>Online Code Runner</h1>

<label>Language:</label>
<select id="language">
    <option value="JAVA">Java</option>
    <option value="CPP">C++</option>
    <option value="PYTHON">Python</option>
    <option value="NODE">Node.js</option>
</select>

<label>Code:</label>
<textarea id="code" placeholder="Write your code here..."></textarea>

<h3>Test Cases</h3>
<div id="testcases"></div>
<button class="btn-small" onclick="addTestCase()">Add Test Case</button>

<button onclick="runCode()">Run Code</button>

<h3>Results:</h3>
<div class="results" id="results"></div>

<script>
let testcaseCount = 0;

// Add new test case
function addTestCase() {
    testcaseCount++;
    const div = document.createElement('div');
    div.className = 'testcase';
    div.id = 'tc' + testcaseCount;
    div.innerHTML = `
        <label>Input:</label>
        <input type="text" class="input" placeholder="Input for test case">
        <label>Expected Output:</label>
        <input type="text" class="expected" placeholder="Expected output">
        <label>Public Test Case:</label>
        <input type="checkbox" class="isPublic" checked>
        <button class="btn-small" onclick="removeTestCase('tc${testcaseCount}')">Remove</button>
    `;
    document.getElementById('testcases').appendChild(div);
}

// Remove test case
function removeTestCase(id) {
    const div = document.getElementById(id);
    div.parentNode.removeChild(div);
}

// Run code
function runCode() {
    const language = document.getElementById('language').value;
    const code = document.getElementById('code').value;
    const testcasesDivs = document.querySelectorAll('.testcase');
    const testCases = [];

    testcasesDivs.forEach(div => {
        const input = div.querySelector('.input').value;
        const expectedOutput = div.querySelector('.expected').value;
        const isPublic = div.querySelector('.isPublic').checked;
        testCases.push({ input, expectedOutput, isPublic });
    });

    if (testCases.length === 0) {
        alert("Please add at least one test case.");
        return;
    }

    const requestBody = { language, code, testCases };

    fetch('code/run', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(requestBody)
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById('results').textContent = JSON.stringify(data, null, 2);
    })
    .catch(err => {
        document.getElementById('results').textContent = 'Error: ' + err;
    });
}

// Add one initial test case
addTestCase();
</script>

</body>
</html>