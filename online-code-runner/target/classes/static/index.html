<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Online Code Runner</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; }
textarea { width: 100%; height: 200px; }
.test-case { margin: 10px 0; padding: 10px; border: 1px solid #ccc; border-radius: 8px; }
.btn { padding: 8px 12px; margin: 5px; cursor: pointer; border: none; border-radius: 5px; }
.btn-run { background: green; color: white; }
.btn-add { background: blue; color: white; }
.btn-remove { background: red; color: white; }
#output { white-space: pre-wrap; background: #f5f5f5; padding: 15px; border: 1px solid #ccc; margin-top: 15px; border-radius: 8px; }
</style>
</head>
<body>
<h1>Online Code Runner</h1>

<label for="language">Language:</label>
<select id="language" onchange="setBoilerplate()">
    <option value="python">Python</option>
    <option value="java">Java</option>
    <option value="cpp">C++</option>
    <option value="node">Node.js</option>
</select>

<h3>Write your code:</h3>
<textarea id="code" placeholder="Write your code here..."></textarea>

<h3>Test Cases</h3>
<div id="testCases"></div>
<button class="btn btn-add" onclick="addTestCase()">+ Add Test Case</button>

<br>
<button class="btn btn-run" onclick="runCode()">Run Code</button>

<h3>Results:</h3>
<div id="output"></div>

<script>

const boilerplates = {
    python: `# Python 3
n = int(input())`,
    
    java: `import java.util.Scanner;
public class Main {
    public static void main(String[] args) {
        Scanner sc = new Scanner(System.in);
        //Write your code here
    }
}`,

    cpp: `#include <iostream>
using namespace std;
int main() {
	 //Write your code here
    return 0;
}`,

    node: `
const readline = require('readline');
const rl = readline.createInterface({
    input: process.stdin,
    output: process.stdout
});
rl.on('line', (line) => {
	 //Write your code here
});`
};

function setBoilerplate() {
    const language = document.getElementById("language").value;
    document.getElementById("code").value = boilerplates[language] || "";
}

function addTestCase() {
    const div = document.createElement("div");
    div.className = "test-case";
    div.innerHTML = `
        <label>Input:</label><br>
        <textarea class="input"></textarea><br>
        <label>Expected Output:</label><br>
        <textarea class="expected"></textarea><br>
        <label>
            <input type="checkbox" class="isPublic" checked>
            Public Test Case
        </label><br>
        <button class="btn btn-remove" onclick="this.parentElement.remove()">Remove</button>
    `;
    document.getElementById("testCases").appendChild(div);
}

async function runCode() {
    const language = document.getElementById("language").value;
    const code = document.getElementById("code").value;

    const testCases = Array.from(document.querySelectorAll(".test-case")).map(tc => {
        return {
            input: tc.querySelector(".input").value,
            expectedOutput: tc.querySelector(".expected").value,
            isPublic: tc.querySelector(".isPublic").checked
        };
    });

    const payload = { language, code, testCases };

    try {
        const response = await fetch("/api/code/run", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload)
        });

        const result = await response.text();
        displayResults(result);
    } catch (err) {
        document.getElementById("output").textContent = "Error: " + err;
    }
}

function displayResults(resultText) {
    const lines = resultText.split("\n");
    const outputDiv = document.getElementById("output");
    outputDiv.innerHTML = "";

    lines.forEach(line => {
        const p = document.createElement("p");
        p.style.margin = "2px 0";

        if (line.includes("✅")) p.style.color = "green";
        else if (line.includes("❌")) p.style.color = "red";
        else p.style.color = "black";

        p.textContent = line;
        outputDiv.appendChild(p);
    });
}

setBoilerplate();
</script>
</body>
</html>