<div>
  <app-admin-header heading="Create Contest"></app-admin-header>
  <div class="p-5">
    <div class="py-5 grid grid-cols-3 grid-rows-2 gap-6">
      <p-floatlabel variant="on" class="w-full">
        <input
          [(ngModel)]="contestName"
          pInputText
          id="contest_name"
          type="text"
          class="w-full"
          autocomplete="off"
        />

        <label for="contest_name">ContestName</label>
      </p-floatlabel>
      <p-floatlabel class="w-full" variant="on">
        <p-select
          [(ngModel)]="eligibility"
          inputId="eligibility"
          [options]="eligibilityOptions"
          class="w-full"
        />
        <label for="eligibility">Eligibility</label>
      </p-floatlabel>
      <div class="flex gap-2 items-center">
        <p-toggleswitch [(ngModel)]="active" />
        <h1 class="font-semibold">Active</h1>
      </div>

      <p-floatlabel class="w-full" variant="on">
        <p-datepicker
          inputId="on_label"
          showIcon
          class="w-full"
          iconDisplay="input"
          [(ngModel)]="startTime"
          [showTime]="true"
          hourFormat="12"
        ></p-datepicker>
        <label for="on_label" class="font-bold block mb-2"> Start time </label>
      </p-floatlabel>

      <p-floatlabel class="w-full" variant="on">
        <p-datepicker
          class="w-full"
          inputId="on_label"
          showIcon
          iconDisplay="input"
          [(ngModel)]="endTime"
          [showTime]="true"
          hourFormat="12"
        ></p-datepicker>
        <label for="on_label" class="font-bold block mb-2"> End time </label>
      </p-floatlabel>
      <p-floatlabel class="w-full" variant="on">
        <input
          class="w-full"
          [(ngModel)]="duration"
          pInputText
          id="contest_name"
          type="number"
          autocomplete="off"
        />

        <label for="contest_name">duration</label>
      </p-floatlabel>
    </div>
    <div class="flex gap-2 py-1.5 px-3 w-full bg-slate-200 h-fit">
      <div
        [ngClass]="[currentSection === 'Mcqs' ? 'bg-blue-500 text-white' : '']"
        class="flex flex-1 justify-center items-center gap-2 w-fit py-2 px-5 h-fit cursor-pointer"
        (click)="changeSection('Mcqs')"
      >
        <img src="/images/test.png" class="w-7 h-7" />
        <p class="font-bold text-lg">Mcqs</p>
      </div>
      <div
        [ngClass]="[
          currentSection === 'Coding' ? 'bg-blue-500 text-white' : ''
        ]"
        class="flex flex-1 justify-center items-center gap-2 w-fit bg-red py-2 px-5 h-fit cursor-pointer"
        (click)="changeSection('Coding')"
      >
        <p class="font-bold text-lg">Coding</p>
      </div>
    </div>
    <div *ngIf="currentSection === 'Mcqs'">
      <h1 class="text-lg font-semibold">Sections</h1>
      <section *ngIf="McqList$ | async as mcqs">
        <div *ngFor="let section of mcqs | keyvalue">
          <div class="flex items-center justify-between mt-3">
            <div class="flex items-center gap-2">
              <div class="font-bold text-xl">{{ section.key }}</div>
              <img
                *ngIf="!checkIsSectionFinalised(section.value)"
                (click)="deleteMcqSection(section.key)"
                src="/svgs/DeleteIcon.svg"
                alt="deleteIcon"
                class="w-5 h-5 cursor-pointer"
              />
            </div>
            <div class="flex gap-2">
              <button
                type="button"
                *ngIf="!checkIsSectionFinalised(section.value)"
                (click)="acceptAllMcqList(section.key)"
                class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
              >
                Accept All
              </button>
              <button
                type="button"
                *ngIf="!checkIsSectionFinalised(section.value)"
                (click)="replaceAll(section.key)"
                class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
              >
                Regenerate
              </button>
            </div>
          </div>
          <div
            class="mt-5 flex flex-col gap-4"
            *ngFor="let question of section.value | keyvalue; index as idx"
          >
            <div
              class="px-5 flex justify-between py-3 rounded-lg shadow-md border border-gray-200"
            >
              <div class="flex flex-col gap-3">
                <div class="flex items-center gap-2">
                  <h1 class="font-bold text-lg">
                    {{ idx + 1 }} . {{ question.value.question }}
                  </h1>
                  <img
                    *ngIf="
                      !(finalisedQuestionsSet$ | async)?.has(
                        question.value.mcqQuestionId
                      )
                    "
                    src="/svgs/DeleteIcon.svg"
                    alt="deleteIcon"
                    (click)="deleteMcqQuestion(section.key, question.key)"
                    class="w-5 h-5 cursor-pointer"
                  />
                </div>
                <div class="flex flex-col gap-1 pl-2 font-medium">
                  <h2>A . {{ question.value.option1 }}</h2>
                  <h2>B . {{ question.value.option2 }}</h2>
                  <h2>C . {{ question.value.option3 }}</h2>
                  <h2>D. {{ question.value.option4 }}</h2>
                </div>

                <div
                  class="w-fit font-semibold px-4 py-2 border-l-3 bg-green-50 text-green-500 border-green-500"
                >
                  Answer : {{ question.value.answerKey }}
                </div>
              </div>
              <div
                *ngIf="
                  !(finalisedQuestionsSet$ | async)?.has(
                    question.value.mcqQuestionId
                  )
                "
                class="flex gap-2"
              >
                <button
                  type="button"
                  (click)="acceptOneMcq(question.value, section.key)"
                  class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
                >
                  Accept
                </button>
                <button
                  type="button"
                  (click)="
                    replaceMcqQuestion(
                      section.key,

                      question.key
                    )
                  "
                  class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
                >
                  Regenerate
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>
    <div *ngIf="currentSection === 'Coding'" class="">
      <form
        class="mt-2"
        [formGroup]="codeQuestionsGeneratorForm"
        (ngSubmit)="AddQuestionPreferences()"
      >
        <div class="text-xl font-bold">Coding</div>
        <div class="flex items-center justify-between">
          <div class="flex gap-2">
            <p-floatlabel variant="on">
              <input
                formControlName="count"
                pInputText
                id="n_count"
                type="number"
                autocomplete="off"
              />

              <label for="n_count">Count</label>
            </p-floatlabel>
            <p-floatlabel variant="on">
              <input
                formControlName="marks"
                pInputText
                id="n_marks"
                type="number"
                autocomplete="off"
              />

              <label for="n_marks">Marks</label>
            </p-floatlabel>

            <p-floatlabel class="w-full md:w-56" variant="on">
              <p-select
                formControlName="difficulty"
                inputId="difficulty"
                [options]="difficultyOptions"
                class="w-full"
              />
              <label for="difficulty">Difficulty</label>
            </p-floatlabel>
          </div>
          <button
            [disabled]="codeQuestionsGeneratorForm.invalid"
            class="px-2 py-1 text-white flex gap-2 text-lg items-center justify-center bg-blue-500 disabled:bg-neutral-500 border-0 outline-0 cursor-pointer font-semibold rounded-sm text-center"
            type="submit"
          >
            Select Preferences
          </button>
        </div>
      </form>
      <form [formGroup]="preferences">
        <div
          *ngIf="PreferencesArray.controls.length"
          class="flex items-start justify-between"
        >
          <div class="mt-2 flex flex-col gap-3" formArrayName="choices">
            <div
              *ngFor="let prefer of PreferencesArray.controls; let idx = index"
              [formGroupName]="idx"
              class="flex gap-3 items-center"
            >
              <div>Q{{ idx + 1 }} Preference</div>

              <p-floatlabel class="w-full md:w-56" variant="on">
                <p-select
                  formControlName="preferredChoice"
                  inputId="difficulty"
                  [options]="difficultyOptions"
                  class="w-full"
                />
                <label for="difficulty">Difficulty</label>
              </p-floatlabel>
              <img
                src="/svgs/DeleteIcon.svg"
                alt="deleteIcon"
                (click)="removeField(idx)"
                class="w-5 h-5 cursor-pointer"
              />
            </div>
          </div>
          <button
            [disabled]="preferences.invalid"
            class="px-2 py-1 mt-2 text-white flex gap-2 text-lg items-center justify-center bg-blue-500 disabled:bg-neutral-500 border-0 outline-0 cursor-pointer font-semibold rounded-sm text-center"
            type="submit"
          >
            Generate Questions
          </button>
        </div>
      </form>
      <section
        class="flex flex-col gap-2 pt-3"
        *ngIf="codingQuestions$ | async as codeQues"
      >
        <div class="flex justify-between items-center">
          <div class="flex gap-2 items-center">
            <h1 class="font-semibold text-lg">Questions</h1>
            <img
              src="/svgs/DeleteIcon.svg"
              alt="deleteIcon"
              class="w-5 h-5 cursor-pointer"
            />
          </div>
          <div class="flex gap-2">
            <button
              type="button"
              (click)="acceptAllCodingquestions(codeQues)"
              class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
            >
              Accept All
            </button>
            <button
              type="button"
              (click)="replaceCodingSection()"
              class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
            >
              Regenerate
            </button>
          </div>
        </div>
        <div *ngFor="let code of codeQues | keyvalue; index as i">
          <div *ngIf="code.value as codingQuestion">
            <app-toggle-section
              [headingText]="constructHeader(codingQuestion.questionName)"
              [showSection]="constructShowSectionCondition(i)"
            >
              <div class="flex flex-col gap-2">
                <div class="flex gap-2 justify-between items-center">
                  <div class="flex gap-2 items-center">
                    <h1 class="font-semibold text-xl">Description</h1>
                    <img
                      (click)="deleteCodeQues(code.key)"
                      src="/svgs/DeleteIcon.svg"
                      alt="deleteIcon"
                      class="w-5 h-5 cursor-pointer"
                    />
                  </div>
                  <div class="flex gap-2 items-center">
                    <button
                      (click)="acceptCodingQuestion(codingQuestion)"
                      type="button"
                      class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
                    >
                      Accept
                    </button>
                    <button
                      type="button"
                      (click)="replaceCodequestion(code.key)"
                      class="py-1 h-fit text-white px-3 border-none outline-none flex gap-2 items-center justify-center font-medium cursor-pointer bg-blue-500 text-lg rounded-sm"
                    >
                      Regenerate
                    </button>
                  </div>
                </div>

                <h2>{{ codingQuestion.description }}</h2>
                <div
                  *ngFor="
                    let testcase of codingQuestion.testcases
                      | testcaseFilter : filterTestCase;
                    index as idx
                  "
                  class="pt-3"
                >
                  <div>Example {{ idx + 1 }} :</div>
                  <div
                    *ngFor="let inputValue of testcase.inputValues; index as i"
                  >
                    {{ codingQuestion.inputParams[i] }} = {{ inputValue }}
                  </div>
                  {{ testcase.explanation }}
                </div>

                <div
                  *ngFor="let testcase of codingQuestion.testcases; index as i"
                >
                  <h1 class="font-semibold text-lg mt-1 text-zinc-500">
                    TestCase - {{ i + 1 }}
                  </h1>
                  <div class="flex items-center justify-between">
                    <div>
                      <div class="font-medium">input : -</div>
                      <div class="flex flex-col gap-2 w-fit">
                        <code
                          class="bg-black text-white px-2 py-1 rounded"
                          *ngFor="
                            let inputValue of testcase.inputValues;
                            index as i
                          "
                        >
                          {{ codingQuestion.inputParams[i] }} = {{ inputValue }}
                        </code>
                      </div>
                      <div class="font-medium">output : -</div>
                      <code class="bg-black text-white px-2 py-1 rounded">
                        {{ testcase.expectedOutput }}
                      </code>
                    </div>
                  </div>
                </div>
              </div>
            </app-toggle-section>
          </div>
        </div>
      </section>
    </div>
  </div>
</div>
